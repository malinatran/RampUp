class Blackjack
	attr_accessor :player, :dealer, :deck
	def initialize
		@player = Player.new
		@dealer = Dealer.new
		@deck = ([1,2,3,4,5,5,6,7,8,9]*4 + [10]*16).shuffle!
	end

	def deal_to_player
		self.player.hand << self.deck.pop
	end 

	def deal_to_dealer
		self.dealer.hand << self.deck.pop
	end 

	def deal_cards
		2.times do 
			deal_to_player
			deal_to_dealer
		end 
	end
end

class Player
	attr_accessor :hand
	def initialize
		@hand = []
	end

	def total_points
		self.hand.inject(:+) # reduces values of an array into one with addition
	end
end

class Dealer
	attr_accessor :hand
	def initialize
		@hand = []
	end 

	def total_points
		self.hand.inject(:+)
	end
end 

class Game
    def initialize
        @game = Blackjack.new
        @game.deal_cards
    end
    
    def run
    	puts "
?????????????????????????????????????? . ################# WELCOME TO LAS VEGAS
?????????????????????????????????????  %  #####################################
????????????????????????????????????  %*:  ############### YOU ARE NOW ENTERING
???????????????????????????????????  %#*?:  ###################################
?????????????????????????????????  ,%##*??:.  ########### THE GAME OF BLACKJACK
???????????????????????????????  ,%##*?*#*??:.  ###############################
?????????????????????????????  ,%###*??*##*???:.  ####### PLAY AT YOUR OWN RISK
???????????????????????????  ,%####*???*###*????:.  ###########################
?????????????????????????  ,%####**????*####**????:.  ### AND GOOD LUCK TO YOU!
???????????????????????  ,%#####**?????*#####**?????:.  #######################
??????????????????????  %######**??????*######**??????:  ######################
?????????????????????  %######**???????*#######**??????:  #####################
????????????????????  %######***???????*#######***??????:  ####################
????????????????????  %######***???????*#######***??????:  ####################
????????????????????  %######***???????*#######***??????:  ####################
?????????????????????  %######**??????***######**??????:  #####################
??????????????????????  '%######****:^%*:^%****??????:'  ######################
????????????????????????   '%####*:'  %*:  '%*????:'   ########################
??????????????????????????           %#*?:           ##########################
?????????????????????????????????  ,%##*??:.  #################################
???????????????????????????????  .%###***???:.  ###############################

"

    	# FIRST PART: If player hits blackjack
    	if @game.player.total_points == 21
    		puts "Lady luck is by your side tonight!
    		You have a hand of #{@game.player.hand} with a total of #{@game.player.total_points} points."
    		return
    	end

    	# SECOND PART: If player's score is less than 21, enter loop
    	while @game.player.total_points < 21
    		puts "You have a hand of #{@game.player.hand} with a total of #{@game.player.total_points} points.
The dealer's visible card is #{@game.dealer.hand.drop(1)}.
Do you want to 1. HIT or 2. STAY?"

    		choice = gets.chomp.to_i
    		if choice == 1
    			@game.deal_to_player
    			if @game.player.total_points == 21
    				puts "You got #{@game.player.total_points} points. We crown you the victor."
    				return
    			elsif @game.player.total_points > 21
    				puts "You got #{@game.player.total_points} points. YA BUSTED."
    				return
    			end
    		elsif choice == 2
    			break
    		end
    	end

    	# THIRD PART: If dealer hits blackjack
    	if @game.dealer.total_points == 21
    		puts "DEALER. JUST. HIT. BLACKJACK. YOU. LOSE. GAME. OVER."
    		return
   		end

   		# FOURTH PART: If dealer's score is less than 21, enter loop
    	while @game.dealer.total_points < 21
        	if @game.dealer.total_points < 17
        		@game.deal_to_dealer
        	elsif @game.dealer.total_points >= 17
        		break
        	end
        end

        # FIFTH PART: No one hits blackjack and no one has busted...
        if @game.dealer.total_points > 21
        	puts "You: #{@game.player.total_points}. Dealer: #{@game.dealer.total_points}. Pah! Dealer busts. You win!"
        elsif @game.dealer.total_points < @game.player.total_points
        	puts "You: #{@game.player.total_points}. Dealer: #{@game.dealer.total_points}. You win!"
        elsif @game.dealer.total_points > @game.player.total_points
        	puts "You: #{@game.player.total_points}. Dealer: #{@game.dealer.total_points}. You lose! Better luck next time."
        else 
        	puts "You: #{@game.player.total_points}. Dealer: #{@game.dealer.total_points}. Sorry, it's a draw."

    end
    
end

Game.new.run
end